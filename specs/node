#!/usr/bin/env bash
source "$(cd "$(dirname "$0")" && pwd)/../pretty-print"

node_major="8"
node_ver="latest-v$node_major.x"

modules=(
	eslint
	prettier
)

title "Node"

if command -v fnm &>/dev/null; then
	if brew outdated fnm | grep -q fnm; then
        echo_install "Upgrading fnm"
        brew upgrade Schniz/tap/fnm > /dev/null
	    print_in_green "${bold}✓ upgraded!${normal}\n"
    else
       print_success_muted "fnm"
    fi
else
	step "Installing FNM…"
	brew install Schniz/tap/fnm > /dev/null
	print_success "fnm installed!"
fi

eval "$(fnm env)"

if ! fnm ls | grep -q "v$node_major."; then
	echo_install "Installing node v$node_major"
	fnm install $node_ver &> /dev/null
	print_in_green "${bold}✓ installed!${normal}\n"
else
	print_success_muted "node v$node_major"
fi

fnm use $node_major > /dev/null

for module in "${modules[@]}"; do
	if ! npm list -g $module > /dev/null; then
		echo_install "Installing $module"
		npm install $module -g --silent > /dev/null
		print_in_green "${bold}✓ installed!${normal}\n"
	else
		print_success_muted "$module"
		npm update $module -g --silent > /dev/null
	fi
done
